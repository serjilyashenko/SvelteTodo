<section class="todoapp">
  <Header on:save="newTodo(event.value)" />
  {#if todos.length}
	<section class="main">
		<input id="toggle-all" class="toggle-all" type="checkbox" on:change="toggleAll(event)" checked={allChecked}>
		<label for="toggle-all">Mark all as complete</label>
		<ul class="todo-list">
			{#each todos as todo}
			<TodoItem {todo} on:remove="remove(todo.id)" on:toggle="toggle(todo.id)" on:change="change(todo.id, event.value)" /> {/each}
		</ul>
	</section>
	<footer class="footer">
		<!-- This should be `0 items left` by default -->
		<span class="todo-count"><strong>0</strong> item left</span>
		<!-- Remove this if you don't implement routing -->
		<ul class="filters">
			<li>
				<a class="selected" href="#/">All</a>
			</li>
			<li>
				<a href="#/active">Active</a>
			</li>
			<li>
				<a href="#/completed">Completed</a>
			</li>
		</ul>
		<!-- Hidden if no completed items are left â†“ -->
		<button class="clear-completed">Clear completed</button>
	</footer>
	{/if}
</section>
<footer class="info">
	<Info/>
</footer>

<script>
  export default {
    data() {
      return {
        todos: [
          { id: 0, title: 'Taste JavaScript', completed: true },
          { id: 1, title: 'Buy a unicorn', completed: false }
        ]
      };
    },
    computed: {
      allChecked: ({todos}) => todos.every(t => t.completed)
    },
    methods: {
      newTodo(title) {
        const todos = this.get().todos;
        const id = Math.max(0, ...todos.map(t => t.id)) + 1;
        const todo = { id, title, completed: false };
        this.set({todos: [...todos, todo]})
      },
      toggle(id) {
        const todos = this.get().todos.map(
          t => (t.id === id ? { ...t, completed: !t.completed } : t)
        );
        this.set({ todos });
      },
      toggleAll(e) {
        const {todos, allChecked} = this.get();
        e.target.checked = allChecked;
        const completed = !allChecked;
        this.set({todos: todos.map(t => ({ ...t, completed }))});
      },
      change(id, value) {
        const todos = this.get().todos.map(
          t => (t.id === id ? { ...t, title: value } : t)
        );
        this.set({ todos });
      },
      remove(id) {
        const todos = this.get().todos.filter(t => t.id !== id);
        this.set({ todos });
      }
    },
    components: {
      Header: './Header.html',
      TodoItem: './TodoItem.html',
      Info: './Info.html'
    }
  };
</script>
